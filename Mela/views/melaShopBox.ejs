<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- fontawesome -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css"
        integrity="sha384-wvfXpqpZZVQGK6TAh5PVlGOfQNHSoD2xbE+QkPxCAFlNEevoEH3Sl0sibVcOQVnN" crossorigin="anonymous">
    <!-- Bootstrap 4 CSS-->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/css/bootstrap.min.css"
        integrity="sha384-9aIt2nRpC12Uk9gS9baDl411NQApFmC26EwAOH8WgZl5MYYxFfc+NcPb1dKGj7Sk" crossorigin="anonymous">
    <!-- Bootstrap 4 JS -->
    <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"
        integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj"
        crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js"
        integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo"
        crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/js/bootstrap.min.js"
        integrity="sha384-OgVRvuATP1z7JjHLkuOU7Xw704+h835Lr+6QL9UvYjZE3Ipu6Tp75j7Bh/kR0JKI"
        crossorigin="anonymous"></script>
    <!-- Animate CSS -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.7.2/animate.min.css">
    <!-- WOW.js -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/wow/1.1.2/wow.min.js"></script>
    <!-- Jquery -->
    <script src="/javascripts/jquery-3.5.1.min.js"></script>
    <!-- 字型 jf-openhuninn-1.1 -->
    <link rel="stylesheet" href="/stylesheets/font/jf-openhuninn-1.1.ttf">
    <!-- CSS -->
    <link rel="stylesheet" href="/stylesheets/MelaStyle.css">
    <link rel="stylesheet" href="/stylesheets/cartListBox.css">
    <!-- JS -->
    <script src="/javascripts/all.js"></script>
    <title>Mela</title>
</head>

<body>

    <!-- 導覽列 -->
    <%- include('./share/navigation',{result}) -%>

    <!-- 購物進度條 -->
    <div class="warp">
        <div class="container-fluid">
            <div class=""></div>
            <ul class="row mt-5">
                <li class="col-2"></li>
                <li class="col-2 text-center"><span class=" step p-2 stepActive"> Step 1</span></li>
                <li class="col-2 text-center"><span class=" step p-2"> Step 2</span></li>
                <li class="col-2 text-center"><span class=" step p-2"> Step 3</span></li>
                <li class="col-2 text-center"><span class=" step p-2"> Step 4</span></li>
            </ul>
            <ul class="row  align-items-center mt-4 mb-5">
                <li class="col-2  align-items-left"></li>
                <li class=" col-2 stepInfo text-center">確認訂購資訊</li>
                <li class=" col-2 stepInfo text-center">填寫付款資料</li>
                <li class=" col-2 stepInfo text-center">訂單明細</li>
                <li class=" col-2 stepInfo text-center">完成訂購</li>
            </ul>
            <!-- 購物車 -->
            <div class="row">
                <div class="col-2"></div>
                <div class="col-8 shoppingCart">
                    <div class="row shoppingCart_title align-bottom">
                        <div class="align-bottom">
                            <h3 class="p-3 pay-info">確認訂購資訊</h3><span>
                            </span>
                        </div>
                    </div>
                    <div class="row cartRow mt-3">
                        <!-- partial:index.partial.html -->
                        <div class="container">
                            <div class="card-deck">
                                <div class="card">
                                    <div class="card-body">
                                        <h5 class="card-title">體驗箱</h5>
                                        <p class="card-text">$899</p>
                                        <div class="imgbox">
                                            <img src="/images/mounthitemA.png" class="wow bounceIn" width="180px">
                                        </div>
                                        <div class="form-row mb-3 mt-3">
                                            <div class="col">
                                                <input type="number" class="form-control amount" placeholder="請輸入數量">
                                            </div>
                                        </div>
                                        <button class="btnMela m-0 add_cart" style="width: 100%;"
                                            data-price="899">加到購物車</button>
                                    </div>
                                </div>
                                <div class="card">
                                    <div class="card-body">
                                        <h5 class="card-title">樂活箱</h5>
                                        <p class="card-text">$799</p>
                                        <div class="imgbox">
                                            <img src="/images/mounthitemA.png" class="wow bounceIn" width="180px">
                                        </div>
                                        <div class="form-row mb-3">
                                            <div class="col mt-3">
                                                <input type="number" class="form-control amount" placeholder="請輸入數量">
                                            </div>
                                        </div>
                                        <button class="btnMela m-0 add_cart" style="width: 100%;"
                                            data-price="799">加到購物車</button>
                                    </div>
                                </div>
                                <div class="card">
                                    <div class="card-body">
                                        <h5 class="card-title ">森活箱</h5>
                                        <p class="card-text">$1099</p>
                                        <div class="imgbox">
                                            <img src="/images/mounthitemB.png" class="wow bounceIn" width="200px">
                                        </div>
                                        <div class="form-row mb-3">
                                            <div class="col mt-2">
                                                <input type="number" class="form-control amount" placeholder="請輸入數量">
                                            </div>
                                        </div>
                                        <button class="btnMela m-0  add_cart" style="width: 100%;"
                                            data-price="1099">加到購物車</button>
                                    </div>
                                </div>
                            </div>



                        </div>
                    </div>
                    <div class="row cartExplain">
                        <!-- <div class="col-3 "><input type="checkbox"><span>&nbsp;同一筆訂單僅送一個地址<br>&nbsp;&nbsp;&nbsp;
                                農產品不能取消訂單</span>
                        </div> -->
                        <div class="row ml-2" style="width: 100%;">
                            <div class="col-2">
                                    <span>購買清單</span>
                                    <div class="pt-4"><button class="btnMela m-0" id="clear">清空購物車</button>
                                    </div>
                            </div>
                            <div class="col-6"></div>
                            <div class="col-4">
                                <ul id="cart"></ul>
                            </div>

                        </div>
                    </div>

                    <div class="col-12 pay pt-3">
                        <span style="color: brown;" class="col-4 float-right pl-4">
                            <div class="">總價:<span id="total" class="mt-3" style="color: brown;"></span> 元</div>
                        </span>
                    </div>

                    <!-- 下一步按鈕 -->
                    <div class="row mt-5 nextBTN">
                        <div class="col-4">
                            <a href="/melaShop">
                                <button class="btnStep btnUp noneActive" style="width: 100%;">回方案購買</button>
                            </a></div>
                        <div class="col-4"></div>
                        <div class="col-4">
                            <a href="/shop/melaShopPayment">
                                <button class="btnStep btnNext" style="width: 100%;">下一步</button>
                            </a></div>
                    </div>
                </div>
            </div>



            <!-- 頁尾 -->
            <div class="footer">
                <%- include('./share/footer') -%>
            </div>
            <!-- 購物車 -->
            <script>
                var cart = [];
                $(".box").click(function () {
                    // alert('已加入購物車，請登入結帳');

                    var product = $(this).closest('.chooseitem');
                    var newItem = {
                        name: product.find('.title').text(),
                        price: product.find('.add_cart').data('price'),
                        amount: product.find('.add_cart').data('amount'),
                    }
                    console.log(newItem);
                    cart.push(newItem);
                    localStorage.setItem("cart", JSON.stringify(cart))
                })

                var cart = [];
                if (localStorage.getItem("cart")) {
                    cart = JSON.parse(localStorage.getItem("cart"));
                }
                setCart();

                function setCart() {
                    var cartList = "", s_price = 0, total = 0;
                    for (let $i = 0; $i < cart.length; $i++) {
                        s_price = cart[$i]["price"] * cart[$i]["amount"];
                        total += s_price;
                        cartList += `<li> ${cart[$i]["name"]} , 單價: ${cart[$i]["price"]}, 數量: ${
                            cart[$i]["amount"]
                            }, 總價: ${s_price}</li>`;
                    }
                    $("#cart")
                        .empty()
                        .append(cartList);
                    $("#total").text(total);
                }

                $("#clear").click(function () {
                    cart = [];
                    localStorage.removeItem("cart");
                    setCart();
                });


                $(".add_cart").click(function () {
                    let product = $(this).closest(".card-body");
                    let newItem = {
                        name: product.find(".card-title").text(),
                        price: $(this).data("price"),
                        amount: product.find(".amount").val()
                    };
                    cart.push(newItem);
                    localStorage.setItem("cart", JSON.stringify(cart));
                    setCart();
                });
            </script>
</body>

</html>